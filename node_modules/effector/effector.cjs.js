function t(t,n){const r={};for(const o in n)r[o]=e.bind({key:o,group:t});return r}function e(t){return{id:D(),type:this.key,group:this.group,data:t}}function n(t){return{id:(++z).toString(36),current:t}}function r(t,e){if(t in V)return I.single(V[t](e));const n=t;for(var r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];switch(n){case'single':return I.single(o[0]);case'multi':return I.multi(o);case'seq':return I.seq(o);case'choose':return I.choose(e);case'loop':return I.loop(e)}return'function'==typeof t?t(e,o):(console.error('unknown node "%s"',t),null)}function o(){const t=this.indexOf();-1!==t&&(this.splice(t,1),this.indexOf=F,this.splice=H)}function a(t,e,n){n.stop=0,L[t.type](t,e,n)}function i(t){try{t.result=t.fn.call(null,t.arg,t.val)}catch(e){console.error(e),t.err=1}return t}function c(t,e,n){this.shortName=t,this.fullName=e,this.path=n}function s(t,e){let n,r;const o=t;return void 0===e?(n=0===t.length?[]:[t],r=t):0===t.length?(n=e.path,r=e.fullName):(n=e.path.concat([t]),r=0===e.fullName.length?t:e.fullName+'/'+t),new c(o,r,n)}function u(t){let e=t.name,n=t.parent;const o=R(),i=e||o,c=function(t){const e=null==n?void 0:n.fullName;return e?e+'/'+t:t||''}(i),f=s(i,n),p=U({fullName:c}),d=function t(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return t.create(e,c,r)};return d.getType=(()=>f.fullName),d.create=(t=>(function(t){(function(e){const n={transactions:[],stop:0,ctx:W.emit({__stepArg:t}),reg:{isChanged:1},val:{}};a(e,n.ctx,n);for(let t=0;t<n.transactions.length;t++)n.transactions[t]();n.transactions.length=0})(d.graphite.seq)}(t),t)),d.kind=G.event,d[$]=(()=>d),d.id=o,d.watch=function(t,e){return l({from:t,to:{graphite:{seq:r("run",{runner:n=>e(n,t.getType())})}}})}.bind(null,d),d.map=function(t,e){const n=u({name:t.shortName+' → *',parent:t.domainName});return l({from:t,to:{graphite:{seq:r("seq",null,r("compute",{fn:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(t=>e(t))}),n.graphite.seq)}}}),n}.bind(null,d),d.filter=function(t,e){const n=u({name:t.shortName+' →? *',parent:t.domainName});return l({from:t,to:{graphite:{seq:r("seq",null,r("compute",{fn:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(t=>e(t))}),r("filter",{filter:t=>void 0!==t}),n.graphite.seq)}}}),n}.bind(null,d),d.prepend=function(t,e){const n=u({name:'* → '+t.shortName,parent:t.domainName});return l({from:n,to:{graphite:{seq:r("seq",null,r("compute",{fn:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(t=>e(t))}),t.graphite.seq)}}}),n}.bind(null,d),d.subscribe=function(t,e){return t.watch(t=>e.next(t))}.bind(null,d),d.graphite=p,d.shortName=i,d.domainName=n,d.compositeName=f,d}function l(t){const e=t.to.graphite.seq,n=t.from.graphite;return n.next.data.push(e),J({child:e,parent:n})}function f(t){return u({name:t})}function p(t){return t.compositeName?t.compositeName.fullName:t.domainName?t.domainName.fullName:t.id}function d(t,e){const n=s(e,t.domainName);t.shortName=e,t.compositeName=n}function m(t){return`${tt} ${t}`}function h(t,e){return`${t}.${e}`}function g(t,e){return`${t} (#${e})`}function v(t,e){if(nt){if(!et)return;ot(),function(t,e){const n=p(t),r=t.id;(function(t){performance.mark(m(t))})(g(h(n,e),r))}(t,e),Z=t,Y=e}}function b(t){if(nt){if(!et)return;null!==Y&&null!==Z&&function(t,e,n){const r=p(t),o=t.id,a=h(r,e);(function(t,e,n){const r=m(e),o=rt(t,n);try{performance.measure(o,r)}catch(t){}performance.clearMarks(r),performance.clearMeasures(o)})(a,g(a,o),n)}(Z,Y,t),Y=null,Z=null}}function y(t){return t.plainState.current}function S(t,e){const n=t.subscribers.get(e);void 0!==n&&(n(),t.subscribers.delete(e))}function N(t,e,n){const o=e;return t.subscribers.set(o,l({from:o,to:{graphite:{seq:r("seq",null,r("compute",{fn:e=>{const r=y(t);return n(r,e,at(o))}}),r("filter",{filter:e=>e!==y(t)&&void 0!==e}),t.graphite.seq)}}})),this}function x(t,e,n){switch(String((null==e?void 0:e.kind)||'__')){case'store':case'event':case'effect':return T('function'==typeof n,'watch requires function handler'),e.watch(r=>n(y(t),r,at(e)));case'__':default:return T('function'==typeof e,'watch requires function handler'),w(t,e)}}function w(t,e){T('function'==typeof e,'Expected the listener to be a function');let n=null,o=y(t);v(t,'subscribe');try{e(o),n='Initial'}catch(t){console.error(t),n='Got initial error'}return b(n),l({from:t,to:{graphite:{seq:r("run",{runner:n=>{let r=null;if(v(t,'subscribe'),n!==o){o=n;try{e(n)}catch(t){console.error(t),r='Got error'}b(r)}else b(r)}})}}})}function q(t){const e=t.currentState,o=t.name,a=t.parent,i=n(e),c=i.id,s=e,u=f('update '+c),p={graphite:ct(i),kind:G.store,id:c,shortName:c,domainName:a,defaultState:s,plainState:i,subscribers:new Map};o&&d(p,o);const m={graphite:p.graphite,kind:G.store,id:c,shortName:c,domainName:a,setState:function(t,e){const n=('function'==typeof e?e:(t,e)=>e)(y(p),t);u(n)},off:S.bind(null,p),watch:x.bind(null,p),subscribe:w.bind(null,p),getState:y.bind(null,p)};return m.reset=function(t,e){return N.call(this,t,e,()=>t.defaultState)}.bind(m,p),m.on=N.bind(m,p),m.defaultState=s,m.map=function(t,e,n){v(t,'map');let o,a=t.getState(),i=null;try{o=e(a,n),i='Initial'}catch(t){console.error(t),i='Got initial error'}b(i);const c=this({name:t.shortName+' → *',currentState:o,parent:t.domainName});return l({from:t,to:{graphite:{seq:r("seq",null,r("compute",{fn:n=>{v(t,'map'),a=n;let r=null;const o=c.getState();let i;try{i=e(n,o)}catch(t){console.error(t),r='Got error'}return b(r),i}}),r("filter",{filter:t=>{const e=t!==c.getState()&&void 0!==t;return e&&(o=t),b(null),e}}),c.graphite.seq)}}}),c}.bind(q,m),m.thru=function(t){return t(this)}.bind(m),m.dispatch=function(t){return t}.bind(null),m[$]=function(t){const e={subscribe:e=>(T('object'==typeof e&&null!==e,'Expected the observer to be an object.'),w(t,function(t){e.next&&e.next(t)}))};return e[$]=function(){return this},e}.bind(null,p),o&&d(m,o),m.on(u,(t,e)=>e),m}function k(t){return void 0!==t&&t!==this.current}function _(t){return q({currentState:t})}function j(t){return Array.isArray(t)?function(t){const e=[...t],n=[...t],o=f('update '+Math.random().toString());let a=[];const i=()=>(a=[],()=>{let t=s.getState();for(const e of a)t=e(t);c=i(),o(t)});let c=i();for(const t of e.map((t,e)=>[e,t])){const e=t[0],o=t[1];if(o.kind===G.store){const t=o,i=r("run",{runner:()=>{}});i.data.data.transactionContext=(t=>(a.push(n=>{const r=[...n];return r[e]=t,r}),c)),n[e]=t.getState(),l({from:t,to:{graphite:{seq:i}}})}}const s=q({name:function(t){let e=0;const n=X-1,r=t.length-1;let o='combine(';for(const a of t){const t=e===n||r===e?'':', ';if(o+=a.kind!==G.store?a.toString()+t:p(a)+t,e+=1,''===t)break}return o+')'}(t),currentState:n});return s.defaultShape=t,s.on(o,(t,e)=>e),s}(t):function(t){const e=Object.assign({},t),n=Object.assign({},t),o=f('update '+Math.random().toString());let a=[];const i=()=>(a=[],()=>{let t=s.getState();for(const e of a)t=e(t);c=i(),o(t)});let c=i();for(const t of Object.entries(e)){const e=t[0],o=t[1];if(o.kind!==G.store)continue;const i=r("run",{runner:()=>{}});i.data.data.transactionContext=(t=>(a.push(n=>Object.assign({},n,{[e]:t})),c)),n[e]=o.getState(),l({from:o,to:{graphite:{seq:i}}})}const s=q({name:function(t){let e=0;const n=Object.keys(t),r=X-1,o=n.length-1;let a='combine(';for(const n in t){const i=e===r||o===e?'':', ',c=t[n];if(a+=c.kind!==G.store?c.toString()+i:p(c)+i,e+=1,''===i)break}return a+')'}(t),currentState:n});return s.defaultShape=t,s.on(o,(t,e)=>e),s}(t)}function E(t){const e={};for(const n of Object.entries(t))e[n[0]]=_(n[1]);return e}function A(t,e){const n=_(e);return n.on(t.done,(t,e)=>e.result),n}function O(t,e){const n=_(e);return n.on(t,(t,e)=>e),n}function C(t){let e=t.parent,n=t.handler;const r=u({name:t.name,parent:e}),o=r.create,a=u({name:r.shortName+' done',parent:e}),i=u({name:r.shortName+' fail',parent:e});r.done=a,r.fail=i,r.use=(t=>(c=t,r)),r.use.getCurrent=(()=>c),r.kind=G.effect,r.create=((t,e,n)=>(o(t,r.getType(),n),ft(t,mt(c,t=>void a(t),t=>void i(t)))));let c=n||function(){return lt(0,'no thunk used in %s',this.getType()),Promise.resolve()}.bind(r);return r}Object.defineProperty(exports,'__esModule',{value:1});var $=function(t){return t&&'object'==typeof t&&'default'in t?t.default:t}(require('symbol-observable'));const M='production'!==process.env.NODE_ENV;var P=function(t){if(!t){var e=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");throw e.framesToPop=1,e}};M&&(P=function(t,e,n,r,o,a,i,c){if(!t){var s=[n,r,o,a,i,c],u=0,l=new Error(e.replace(/%s/g,function(){return s[u++]}));throw l.name='Invariant Violation',l.framesToPop=1,l}});var T=P;const G={none:'none',store:'store',event:'event',effect:'effect'},B=()=>{let t=0;return()=>(++t).toString(36)},D=B(),I=t('step',{single:null,multi:null,seq:null,choose:null,loop:null}),V=t('cmd',{compute:null,emit:null,run:null,filter:null,update:null}),W=t('ctx',{compute:null,emit:null,run:null,filter:null,update:null});let z=0;const F=()=>-1,H=()=>[],J=t=>{const e=t.parent.next.data,n={indexOf:e.indexOf.bind(e,t.child),splice:e.splice.bind(e)},r=o.bind(n);return r.unsubscribe=o.bind(n),r},K={single(t,e,n){n.arg=e.data.__stepArg,n.ctx=Q[t.data.type].cmd(t.data,n),n.stop=!Q[n.ctx.type].transition(n.reg)},multi(t,e,n){const r=t.data.slice();for(let t=0;t<r.length;t++)a(r[t],e,n);n.stop=0},seq(t,e,n){n.ctx=e;const r=t.data.slice();for(let t=0;t<r.length&&(a(r[t],n.ctx,n),!n.stop);t++);}},L={};L.single=K.single,L.multi=K.multi,L.seq=K.seq;const Q={emit:{cmd:(t,e)=>W.emit({__stepArg:e.arg}),transition:()=>1},filter:{cmd(t,e){const n=W.filter({__stepArg:e.arg}),r=i({err:0,result:null,arg:e.arg,val:e.val,fn:t.data.filter});return e.reg.isChanged=Boolean(r.result),n},transition:t=>Boolean(t.isChanged)},run:{cmd(t,e){const n=W.run({});return'transactionContext'in t.data&&e.transactions.push(t.data.transactionContext(e.arg)),i({err:0,result:null,arg:e.arg,val:e.val,fn:t.data.runner}),n},transition:()=>0},update:{cmd(t,e){let r;return(r='val'in t.data?e.val[t.data.val]=e.val[t.data.val]||n(null):t.data.store).current=e.arg,W.update({__stepArg:e.arg})},transition:()=>1},compute:{cmd(t,e){const n=W.compute({__stepArg:null}),r=i({err:0,result:null,arg:e.arg,val:e.val,fn:t.data.fn});return e.reg.isChanged=!r.err&&void 0!==r.result,r.err||(n.data.__stepArg=r.result),n},transition:t=>Boolean(t.isChanged)}},R=B(),U=t=>{const e=r("multi",null);return{next:e,seq:r("seq",null,r("emit",{fullName:t.fullName}),e)}},X=25;let Y=null,Z=null;const tt='☄',et='undefined'!=typeof performance&&'function'==typeof performance.mark&&'function'==typeof performance.clearMarks&&'function'==typeof performance.measure&&'function'==typeof performance.clearMeasures,nt=M,rt=(t,e)=>`${`${tt} `}${t}${e?` Warning: ${e}`:''}`,ot=()=>{null!==Y&&null!==Z&&function(t,e){const n=p(t),r=t.id;(function(t){performance.clearMarks(m(t))})(g(h(n,e),r))}(Z,Y),Z=null,Y=null},at=t=>{switch(t.kind){case G.store:return t.shortName;default:return t.getType()}},ct=t=>{const e={};return e.next=r("multi",null),e.seq=r("seq",null,r("filter",{filter:k.bind(t)}),r("update",{store:t}),e.next),e},st={store:t=>t.obj,event:t=>O(t.obj,t.defaultState),effect:t=>A(t.obj,t.defaultState),__:t=>E(t.obj)};var ut=function(){};M&&(ut=function(t,e,n){var r=arguments.length;n=new Array(r>2?r-2:0);for(var o=2;o<r;o++)n[o-2]=arguments[o];t||function(t,e){var n=arguments.length;e=new Array(n>1?n-1:0);for(var r=1;r<n;r++)e[r-1]=arguments[r];var o=0,a='Warning: '+t.replace(/%s/g,function(){return e[o++]});console.error(a)}.apply(null,[e].concat(n))});var lt=ut;const ft=(t,e)=>{let n,r,o,a=0;try{r=e[2](t),a=1}catch(t){n=t}if(0==a){(o=Promise.reject(n)).cache=(()=>void 0);const r=Promise.resolve(void 0);return o.anyway=(()=>r),e[1]({params:t,error:n}),o}if('object'==typeof r&&null!==r&&'function'==typeof r.then){const n=(o=r.then(n=>(o.cache=(()=>n),e[0]({params:t,result:n}),n),n=>{throw e[1]({params:t,error:n}),n})).then(()=>{},()=>{});return o.anyway=(()=>n),o}const i=r;(o=Promise.resolve(i)).cache=(()=>i);const c=Promise.resolve(void 0);return o.anyway=(()=>c),e[0]({params:t,result:i}),o},pt=function(t){const e=this[3];this.length=0,e(t)},dt=function(t){const e=this[4];this.length=0,e(t)},mt=(t,e,n)=>[pt,dt,t,e,n];class ht{constructor(){this.events=new Set,this.effects=new Set,this.storages=new Set,this.domains=new Set}}const gt=B();exports.combine=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];T(e.length>0,'at least one argument required');const r=e[e.length-1];return j(e.slice(0,-1)).map(t=>r(...t))},exports.createDomain=function(t){return function t(e,n,r){const o=gt(),a=s(e||'',n),i=new ht,c=function(t,e,n){let r;return(r=n?(t=>({event:t.event.prepend(t=>t),effect:t.effect.prepend(t=>t),store:t.store.prepend(t=>t),domain:t.domain.prepend(t=>t)}))(n):(t=>({event:u({name:`${t.fullName} event hook`,parent:t}),effect:u({name:`${t.fullName} effect hook`,parent:t}),store:u({name:`${t.fullName} store hook`,parent:t}),domain:u({parent:t})}))(e)).domain.watch(e=>{t.domains.add(e)}),r.event.watch(e=>{t.events.add(e)}),r.store.watch(e=>{t.storages.add(e)}),r.effect.watch(e=>{t.effects.add(e)}),r}(i,a,r);return{compositeName:a,id:o,getType:()=>a.fullName,onCreateEvent:t=>(i.events.forEach(t),c.event.watch(t)),onCreateEffect:t=>(i.effects.forEach(t),c.effect.watch(t)),onCreateStore:t=>(i.storages.forEach(t),c.store.watch(t)),onCreateDomain:t=>(i.domains.forEach(t),c.domain.watch(t)),event(t){const e=u({name:t,parent:a});return c.event(e),e},effect(t){const e=C({name:t,domainName:a.fullName,parent:a});return c.effect(e),e},domain(e){const n=t(e,a,c);return c.domain(n),n},store(t){const e=q({currentState:t,parent:a});return c.store(e),e}}}(void 0===t?'':t)},exports.createEvent=f,exports.forward=l,exports.createEffect=function(t,e){const n={};return n.name=t,n.domainName='',n.handler=null==e?void 0:e.handler,C(n)},exports.createStore=_,exports.createStoreObject=j,exports.setStoreName=d,exports.extract=function(t,e){let n;return j(n=e('defaultShape'in t?t.defaultShape:t.defaultState))},exports.createApi=function(t,e){const n={};for(const r of Object.entries(e)){const e=r[0],o=r[1],a=f(e);t.on(a,o),n[e]=a}return n},exports.restore=function(t,e){return st[String((null==t?void 0:t.kind)||'__')]({obj:t,defaultState:e})},exports.restoreEvent=O,exports.restoreEffect=A,exports.restoreObject=E,exports.withProps=function(t,e){return n=>e(t.getState(),n)};
//# sourceMappingURL=effector.cjs.js.map
