function t(t,e){const r={};for(const o in e)r[o]=n.bind({key:o,group:t});return r}function n(t){return{id:J(),type:this.key,group:this.group,data:t}}function e(t){return{id:(++R).toString(36),current:t}}function r(t,n){if(t in L)return K.single(L[t](n));const e=t;for(var r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];switch(e){case'single':return K.single(o[0]);case'multi':return K.multi(o);case'seq':return K.seq(o);case'choose':return K.choose(n);case'loop':return K.loop(n)}return'function'==typeof t?t(n,o):(console.error('unknown node "%s"',t),null)}function o(){const t=this.indexOf();-1!==t&&(this.splice(t,1),this.indexOf=U,this.splice=X)}function a(t,n,e){e.stop=0,tt[t.type](t,n,e)}function i(t){try{t.result=t.fn.call(null,t.arg,t.val)}catch(n){console.error(n),t.err=1}return t}function u(t,n,e){this.shortName=t,this.fullName=n,this.path=e}function c(t,n){let e,r;const o=t;return void 0===n?(e=0===t.length?[]:[t],r=t):0===t.length?(e=n.path,r=n.fullName):(e=n.path.concat([t]),r=0===n.fullName.length?t:n.fullName+'/'+t),new u(o,r,e)}function s(t){let n=t.name,e=t.parent;const o=et(),i=n||o,u=function(t){const n=null==e?void 0:e.fullName;return n?n+'/'+t:t||''}(i),f=c(i,e),d=rt({fullName:u}),m=function t(n){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];return t.create(n,u,r)};return m.getType=(()=>f.fullName),m.create=(t=>(function(t){(function(n){const e={transactions:[],stop:0,ctx:Q.emit({__stepArg:t}),reg:{isChanged:1},val:{}};a(n,e.ctx,e);for(let t=0;t<e.transactions.length;t++)e.transactions[t]();e.transactions.length=0})(m.graphite.seq)}(t),t)),m.kind=F.event,m[D]=(()=>m),m.id=o,m.watch=function(t,n){return l({from:t,to:{graphite:{seq:r("run",{runner:e=>n(e,t.getType())})}}})}.bind(null,m),m.map=function(t,n){const e=s({name:t.shortName+' → *',parent:t.domainName});return l({from:t,to:{graphite:{seq:r("seq",null,r("compute",{fn:function(t){function n(n){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(t=>n(t))}),e.graphite.seq)}}}),e}.bind(null,m),m.filter=function(t,n){const e=s({name:t.shortName+' →? *',parent:t.domainName});return l({from:t,to:{graphite:{seq:r("seq",null,r("compute",{fn:function(t){function n(n){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(t=>n(t))}),r("filter",{filter:t=>void 0!==t}),e.graphite.seq)}}}),e}.bind(null,m),m.prepend=function(t,n){const e=s({name:'* → '+t.shortName,parent:t.domainName});return l({from:e,to:{graphite:{seq:r("seq",null,r("compute",{fn:function(t){function n(n){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(t=>n(t))}),t.graphite.seq)}}}),e}.bind(null,m),m.subscribe=function(t,n){return t.watch(t=>n.next(t))}.bind(null,m),m.graphite=d,m.shortName=i,m.domainName=e,m.compositeName=f,m}function l(t){const n=t.to.graphite.seq,e=t.from.graphite;return e.next.data.push(n),Y({child:n,parent:e})}function f(t){return s({name:t})}function d(t,n){return e=>n(t.getState(),e)}function m(t){return t.compositeName?t.compositeName.fullName:t.domainName?t.domainName.fullName:t.id}function p(t,n){const e=c(n,t.domainName);t.shortName=n,t.compositeName=e}function h(t){return`${ct} ${t}`}function g(t,n){return`${t}.${n}`}function v(t,n){return`${t} (#${n})`}function b(t,n){if(lt){if(!st)return;dt(),function(t,n){const e=m(t),r=t.id;(function(t){performance.mark(h(t))})(v(g(e,n),r))}(t,n),ut=t,at=n}}function y(t){if(lt){if(!st)return;null!==at&&null!==ut&&function(t,n,e){const r=m(t),o=t.id,a=g(r,n);(function(t,n,e){const r=h(n),o=ft(t,e);try{performance.measure(o,r)}catch(t){}performance.clearMarks(r),performance.clearMeasures(o)})(a,v(a,o),e)}(ut,at,t),at=null,ut=null}}function S(t){return t.plainState.current}function N(t,n){const e=t.subscribers.get(n);void 0!==e&&(e(),t.subscribers.delete(n))}function w(t,n,e){const o=n;return t.subscribers.set(o,l({from:o,to:{graphite:{seq:r("seq",null,r("compute",{fn:n=>{const r=S(t);return e(r,n,mt(o))}}),r("filter",{filter:n=>n!==S(t)&&void 0!==n}),t.graphite.seq)}}})),this}function q(t,n,e){switch(String((null==n?void 0:n.kind)||'__')){case'store':case'event':case'effect':return z('function'==typeof e,'watch requires function handler'),n.watch(r=>e(S(t),r,mt(n)));case'__':default:return z('function'==typeof n,'watch requires function handler'),x(t,n)}}function x(t,n){z('function'==typeof n,'Expected the listener to be a function');let e=null,o=S(t);b(t,'subscribe');try{n(o),e='Initial'}catch(t){console.error(t),e='Got initial error'}return y(e),l({from:t,to:{graphite:{seq:r("run",{runner:e=>{let r=null;if(b(t,'subscribe'),e!==o){o=e;try{n(e)}catch(t){console.error(t),r='Got error'}y(r)}else y(r)}})}}})}function k(t){const n=t.currentState,o=t.name,a=t.parent,i=e(n),u=i.id,c=n,s=f('update '+u),d={graphite:pt(i),kind:F.store,id:u,shortName:u,domainName:a,defaultState:c,plainState:i,subscribers:new Map};o&&p(d,o);const m={graphite:d.graphite,kind:F.store,id:u,shortName:u,domainName:a,setState:function(t,n){const e=('function'==typeof n?n:(t,n)=>n)(S(d),t);s(e)},off:N.bind(null,d),watch:q.bind(null,d),subscribe:x.bind(null,d),getState:S.bind(null,d)};return m.reset=function(t,n){return w.call(this,t,n,()=>t.defaultState)}.bind(m,d),m.on=w.bind(m,d),m.defaultState=c,m.map=function(t,n,e){b(t,'map');let o,a=t.getState(),i=null;try{o=n(a,e),i='Initial'}catch(t){console.error(t),i='Got initial error'}y(i);const u=this({name:t.shortName+' → *',currentState:o,parent:t.domainName});return l({from:t,to:{graphite:{seq:r("seq",null,r("compute",{fn:e=>{b(t,'map'),a=e;let r=null;const o=u.getState();let i;try{i=n(e,o)}catch(t){console.error(t),r='Got error'}return y(r),i}}),r("filter",{filter:t=>{const n=t!==u.getState()&&void 0!==t;return n&&(o=t),y(null),n}}),u.graphite.seq)}}}),u}.bind(k,m),m.thru=function(t){return t(this)}.bind(m),m.dispatch=function(t){return t}.bind(null),m[D]=function(t){const n={subscribe:n=>(z('object'==typeof n&&null!==n,'Expected the observer to be an object.'),x(t,function(t){n.next&&n.next(t)}))};return n[D]=function(){return this},n}.bind(null,d),o&&p(m,o),m.on(s,(t,n)=>n),m}function _(t){return void 0!==t&&t!==this.current}function j(t){return k({currentState:t})}function A(t){return Array.isArray(t)?function(t){const n=[...t],e=[...t],o=f('update '+Math.random().toString());let a=[];const i=()=>(a=[],()=>{let t=c.getState();for(const n of a)t=n(t);u=i(),o(t)});let u=i();for(const t of n.map((t,n)=>[n,t])){const n=t[0],o=t[1];if(o.kind===F.store){const t=o,i=r("run",{runner:()=>{}});i.data.data.transactionContext=(t=>(a.push(e=>{const r=[...e];return r[n]=t,r}),u)),e[n]=t.getState(),l({from:t,to:{graphite:{seq:i}}})}}const c=k({name:function(t){let n=0;const e=ot-1,r=t.length-1;let o='combine(';for(const a of t){const t=n===e||r===n?'':', ';if(o+=a.kind!==F.store?a.toString()+t:m(a)+t,n+=1,''===t)break}return o+')'}(t),currentState:e});return c.defaultShape=t,c.on(o,(t,n)=>n),c}(t):function(t){const n=Object.assign({},t),e=Object.assign({},t),o=f('update '+Math.random().toString());let a=[];const i=()=>(a=[],()=>{let t=c.getState();for(const n of a)t=n(t);u=i(),o(t)});let u=i();for(const t of Object.entries(n)){const n=t[0],o=t[1];if(o.kind!==F.store)continue;const i=r("run",{runner:()=>{}});i.data.data.transactionContext=(t=>(a.push(e=>Object.assign({},e,{[n]:t})),u)),e[n]=o.getState(),l({from:o,to:{graphite:{seq:i}}})}const c=k({name:function(t){let n=0;const e=Object.keys(t),r=ot-1,o=e.length-1;let a='combine(';for(const e in t){const i=n===r||o===n?'':', ',u=t[e];if(a+=u.kind!==F.store?u.toString()+i:m(u)+i,n+=1,''===i)break}return a+')'}(t),currentState:e});return c.defaultShape=t,c.on(o,(t,n)=>n),c}(t)}function C(t,n){let e;return A(e=n('defaultShape'in t?t.defaultShape:t.defaultState))}function $(t,n){const e={};for(const r of Object.entries(n)){const n=r[0],o=r[1],a=f(n);t.on(a,o),e[n]=a}return e}function E(t){const n={};for(const e of Object.entries(t))n[e[0]]=j(e[1]);return n}function O(t,n){const e=j(n);return e.on(t.done,(t,n)=>n.result),e}function M(t,n){const e=j(n);return e.on(t,(t,n)=>n),e}function T(t,n){return ht[String((null==t?void 0:t.kind)||'__')]({obj:t,defaultState:n})}function P(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];z(n.length>0,'at least one argument required');const r=n[n.length-1];return A(n.slice(0,-1)).map(t=>r(...t))}function G(t){let n=t.parent,e=t.handler;const r=s({name:t.name,parent:n}),o=r.create,a=s({name:r.shortName+' done',parent:n}),i=s({name:r.shortName+' fail',parent:n});r.done=a,r.fail=i,r.use=(t=>(u=t,r)),r.use.getCurrent=(()=>u),r.kind=F.effect,r.create=((t,n,e)=>(o(t,r.getType(),e),bt(t,Nt(u,t=>void a(t),t=>void i(t)))));let u=e||function(){return vt(0,'no thunk used in %s',this.getType()),Promise.resolve()}.bind(r);return r}function B(t,n){const e={};return e.name=t,e.domainName='',e.handler=null==n?void 0:n.handler,G(e)}function I(t){return function t(n,e,r){const o=kt(),a=c(n||'',e),i=new wt,u=function(t,n,e){let r;return(r=e?xt(e):qt(n)).domain.watch(n=>{t.domains.add(n)}),r.event.watch(n=>{t.events.add(n)}),r.store.watch(n=>{t.storages.add(n)}),r.effect.watch(n=>{t.effects.add(n)}),r}(i,a,r);return{compositeName:a,id:o,getType:()=>a.fullName,onCreateEvent:t=>(i.events.forEach(t),u.event.watch(t)),onCreateEffect:t=>(i.effects.forEach(t),u.effect.watch(t)),onCreateStore:t=>(i.storages.forEach(t),u.store.watch(t)),onCreateDomain:t=>(i.domains.forEach(t),u.domain.watch(t)),event(t){const n=s({name:t,parent:a});return u.event(n),n},effect(t){const n=G({name:t,domainName:a.fullName,parent:a});return u.effect(n),n},domain(n){const e=t(n,a,u);return u.domain(e),e},store(t){const n=k({currentState:t,parent:a});return u.store(n),n}}}(void 0===t?'':t)}import D from'symbol-observable';const V='production'!==process.env.NODE_ENV;var W=function(t){if(!t){var n=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");throw n.framesToPop=1,n}};V&&(W=function(t,n,e,r,o,a,i,u){if(!t){var c=[e,r,o,a,i,u],s=0,l=new Error(n.replace(/%s/g,function(){return c[s++]}));throw l.name='Invariant Violation',l.framesToPop=1,l}});var z=W;const F={none:'none',store:'store',event:'event',effect:'effect'},H=()=>{let t=0;return()=>(++t).toString(36)},J=H(),K=t('step',{single:null,multi:null,seq:null,choose:null,loop:null}),L=t('cmd',{compute:null,emit:null,run:null,filter:null,update:null}),Q=t('ctx',{compute:null,emit:null,run:null,filter:null,update:null});let R=0;const U=()=>-1,X=()=>[],Y=t=>{const n=t.parent.next.data,e={indexOf:n.indexOf.bind(n,t.child),splice:n.splice.bind(n)},r=o.bind(e);return r.unsubscribe=o.bind(e),r},Z={single(t,n,e){e.arg=n.data.__stepArg,e.ctx=nt[t.data.type].cmd(t.data,e),e.stop=!nt[e.ctx.type].transition(e.reg)},multi(t,n,e){const r=t.data.slice();for(let t=0;t<r.length;t++)a(r[t],n,e);e.stop=0},seq(t,n,e){e.ctx=n;const r=t.data.slice();for(let t=0;t<r.length&&(a(r[t],e.ctx,e),!e.stop);t++);}},tt={};tt.single=Z.single,tt.multi=Z.multi,tt.seq=Z.seq;const nt={emit:{cmd:(t,n)=>Q.emit({__stepArg:n.arg}),transition:()=>1},filter:{cmd(t,n){const e=Q.filter({__stepArg:n.arg}),r=i({err:0,result:null,arg:n.arg,val:n.val,fn:t.data.filter});return n.reg.isChanged=Boolean(r.result),e},transition:t=>Boolean(t.isChanged)},run:{cmd(t,n){const e=Q.run({});return'transactionContext'in t.data&&n.transactions.push(t.data.transactionContext(n.arg)),i({err:0,result:null,arg:n.arg,val:n.val,fn:t.data.runner}),e},transition:()=>0},update:{cmd(t,n){let r;return(r='val'in t.data?n.val[t.data.val]=n.val[t.data.val]||e(null):t.data.store).current=n.arg,Q.update({__stepArg:n.arg})},transition:()=>1},compute:{cmd(t,n){const e=Q.compute({__stepArg:null}),r=i({err:0,result:null,arg:n.arg,val:n.val,fn:t.data.fn});return n.reg.isChanged=!r.err&&void 0!==r.result,r.err||(e.data.__stepArg=r.result),e},transition:t=>Boolean(t.isChanged)}},et=H(),rt=t=>{const n=r("multi",null);return{next:n,seq:r("seq",null,r("emit",{fullName:t.fullName}),n)}},ot=25;let at=null,ut=null;const ct='☄',st='undefined'!=typeof performance&&'function'==typeof performance.mark&&'function'==typeof performance.clearMarks&&'function'==typeof performance.measure&&'function'==typeof performance.clearMeasures,lt=V,ft=(t,n)=>`${`${ct} `}${t}${n?` Warning: ${n}`:''}`,dt=()=>{null!==at&&null!==ut&&function(t,n){const e=m(t),r=t.id;(function(t){performance.clearMarks(h(t))})(v(g(e,n),r))}(ut,at),ut=null,at=null},mt=t=>{switch(t.kind){case F.store:return t.shortName;default:return t.getType()}},pt=t=>{const n={};return n.next=r("multi",null),n.seq=r("seq",null,r("filter",{filter:_.bind(t)}),r("update",{store:t}),n.next),n},ht={store:t=>t.obj,event:t=>M(t.obj,t.defaultState),effect:t=>O(t.obj,t.defaultState),__:t=>E(t.obj)};var gt=function(){};V&&(gt=function(t,n,e){var r=arguments.length;e=new Array(r>2?r-2:0);for(var o=2;o<r;o++)e[o-2]=arguments[o];t||function(t,n){var e=arguments.length;n=new Array(e>1?e-1:0);for(var r=1;r<e;r++)n[r-1]=arguments[r];var o=0,a='Warning: '+t.replace(/%s/g,function(){return n[o++]});console.error(a)}.apply(null,[n].concat(e))});var vt=gt;const bt=(t,n)=>{let e,r,o,a=0;try{r=n[2](t),a=1}catch(t){e=t}if(0==a){(o=Promise.reject(e)).cache=(()=>void 0);const r=Promise.resolve(void 0);return o.anyway=(()=>r),n[1]({params:t,error:e}),o}if('object'==typeof r&&null!==r&&'function'==typeof r.then){const e=(o=r.then(e=>(o.cache=(()=>e),n[0]({params:t,result:e}),e),e=>{throw n[1]({params:t,error:e}),e})).then(()=>{},()=>{});return o.anyway=(()=>e),o}const i=r;(o=Promise.resolve(i)).cache=(()=>i);const u=Promise.resolve(void 0);return o.anyway=(()=>u),n[0]({params:t,result:i}),o},yt=function(t){const n=this[3];this.length=0,n(t)},St=function(t){const n=this[4];this.length=0,n(t)},Nt=(t,n,e)=>[yt,St,t,n,e];class wt{constructor(){this.events=new Set,this.effects=new Set,this.storages=new Set,this.domains=new Set}}const qt=t=>({event:s({name:`${t.fullName} event hook`,parent:t}),effect:s({name:`${t.fullName} effect hook`,parent:t}),store:s({name:`${t.fullName} store hook`,parent:t}),domain:s({parent:t})}),xt=t=>({event:t.event.prepend(t=>t),effect:t.effect.prepend(t=>t),store:t.store.prepend(t=>t),domain:t.domain.prepend(t=>t)}),kt=H();export{P as combine,I as createDomain,f as createEvent,l as forward,B as createEffect,j as createStore,A as createStoreObject,p as setStoreName,C as extract,$ as createApi,T as restore,M as restoreEvent,O as restoreEffect,E as restoreObject,d as withProps};
//# sourceMappingURL=effector.es.js.map
