{"version":3,"file":"effector-react.cjs.js","sources":["node_modules/effector-react/createStoreConsumer.js","node_modules/effector-react/createReactState.js","node_modules/effector-react/createGate.js","node_modules/effector-react/createStoreProvider.js","node_modules/effector-react/createContextComponent.js","node_modules/effector-react/createComponent.js","node_modules/effector-react/useStore.js","node_modules/effector-react/connect.js"],"sourcesContent":["//@flow\n\nimport * as React from 'react'\n\nimport type {Store} from 'effector'\n\nimport type {StoreConsumer} from './index.h'\n\ntype Unsubscribe = () => void\n\nexport function createStoreConsumer<State>(\n  store: Store<State>,\n): StoreConsumer<State> {\n  return class StoreConsumer extends React.Component<\n    {\n      children: State => React.Node,\n    },\n    {currentState: State},\n  > {\n    static displayName = `${store.shortName}.Consumer`\n\n    state = {currentState: store.getState()}\n\n    _unsubscribe: Unsubscribe | null = null\n    _hasUnmounted: boolean = false\n\n    componentDidMount() {\n      this.subscribe()\n    }\n    componentWillUnmount() {\n      this.unsubscribe()\n      this._hasUnmounted = true\n    }\n    render() {\n      return this.props.children(this.state.currentState)\n    }\n\n    subscribe() {\n      const callback = (state: State) => {\n        if (this._hasUnmounted) {\n          return\n        }\n\n        this.setState(prevState => {\n          if (state === prevState.currentState) {\n            return null\n          }\n          return {currentState: state}\n        })\n      }\n\n      const unsubscribe = store.subscribe(callback)\n\n      this._unsubscribe = unsubscribe\n    }\n    unsubscribe() {\n      if (typeof this._unsubscribe === 'function') {\n        this._unsubscribe()\n      }\n\n      this._unsubscribe = null\n    }\n  }\n}\n","//@flow\n\nimport * as React from 'react'\nimport {createStoreConsumer} from './createStoreConsumer'\n\nimport type {Store} from 'effector'\n\nexport function createReactState<State: Object, Com: React.ComponentType<*>>(\n  store: Store<State>,\n  Component: Com,\n): React.ComponentType<$Exact<$Diff<React.ElementConfig<Com>, State>>> {\n  const Store = createStoreConsumer(store)\n  const ConnectedComponent = props => (\n    <Store>{state => <Component {...props} {...state} />}</Store>\n  )\n  const wrappedComponentName =\n    Component.displayName || Component.name || 'Unknown'\n  ConnectedComponent.displayName = `Connect(${wrappedComponentName})`\n  return ConnectedComponent\n}\n","//@flow\n\nimport * as React from 'react'\nimport {useEffect} from 'react'\nimport {createDomain, createApi, type Store, type Event} from 'effector'\n\nconst {store: createStore} = createDomain('Gate')\n\nexport type Gate<Props = {||}> = Class<React.Component<Props, any>> & {\n  isOpen: boolean,\n  isTerminated: boolean,\n  open: Event<void>,\n  close: Event<void>,\n  status: Store<boolean>,\n  destructor: Event<void>,\n  current: Props,\n  state: Store<Props>,\n  set: Event<Props>,\n  childGate<Next>(childName?: string): Gate<Next>,\n}\n\nexport function useGate<Props>(\n  GateComponent: Gate<Props>,\n  props?: Props = ({}: any),\n) {\n  useEffect(() => {\n    GateComponent.open()\n    return () => GateComponent.close()\n  }, [GateComponent])\n  GateComponent.set(props)\n}\n\nexport function createGate<Props>(\n  name: string = 'gate',\n  defaultState: Props = ({}: any),\n): Gate<Props> {\n  const status = createStore(false)\n  const state: Store<Props> = createStore(defaultState)\n  const {set} = createApi(state, {\n    set: (_, state) => state,\n  })\n\n  const {open, close, destructor} = createApi(status, {\n    open: () => GateComponent.predicate() && true,\n    close: () => false,\n    destructor: () => false,\n  })\n\n  class GateComponent extends React.PureComponent<Props> {\n    static predicate = () => true\n\n    static displayName = `Gate:${name}`\n    static isOpen = false\n    static current = state.getState()\n    static open = open\n    static close = close\n    static status = status\n    static state = state\n    static set = set\n    static destructor = destructor\n    static isTerminated = false\n    static childGate<Next>(childName: string = 'Subgate'): Gate<Next> {\n      const gate = createGate(`${name}/${childName}`)\n      ;(gate: any).predicate = () => GateComponent.status.getState()\n      let isOpen = false\n      let isFeedback = false\n      gate.open.watch(() => {\n        if (!isFeedback) isOpen = true\n      })\n      gate.close.watch(() => {\n        if (!isFeedback) isOpen = false\n      })\n\n      GateComponent.status.watch(status => {\n        isFeedback = true\n        if (isOpen && status && !gate.status.getState()) {\n          gate.open()\n        }\n        isFeedback = false\n      })\n      GateComponent.close.watch(() => {\n        isFeedback = true\n        gate.close()\n        isFeedback = false\n      })\n      GateComponent.destructor.watch(() => gate.destructor())\n      return gate\n    }\n\n    componentDidMount() {\n      GateComponent.open()\n    }\n    componentWillUnmount() {\n      GateComponent.close()\n    }\n    render() {\n      GateComponent.set(this.props)\n      return null\n    }\n  }\n  const unwatch = status.watch(status => (GateComponent.isOpen = status))\n  const unwatch2 = state.watch(current => (GateComponent.current = current))\n  const unwatch3 = status.map(status => {\n    if (!status) GateComponent.current = defaultState\n  })\n  state.reset(close)\n\n  const setTerminated = destructor.watch(() => {\n    GateComponent.isTerminated = true\n  })\n  const unstate = () => {\n    GateComponent.status.off(GateComponent.open)\n    GateComponent.status.off(GateComponent.close)\n    GateComponent.status.off(GateComponent.destructor)\n  }\n\n  const undestruct = destructor.watch(() => {\n    undestruct()\n    unwatch()\n    unwatch2()\n    setTerminated()\n    unstate()\n    GateComponent.state.off(GateComponent.set)\n  })\n  return GateComponent\n}\n","//@flow\n\nimport * as React from 'react'\n\nimport type {Store} from 'effector'\n\nimport type {StoreProvider} from './index.h'\n\nexport function unstable_createStoreProvider<State>(\n  store: Store<State>,\n): StoreProvider<State> {\n  return class StoreProvider extends React.Component<\n    {\n      value: State,\n      children: React.Node,\n    },\n    {\n      currentValue: React.Node,\n    },\n  > {\n    static displayName = `${store.shortName}.Provider`\n    static defaultProps = {\n      children: null,\n    }\n    state = {\n      currentValue: null,\n    }\n    static getDerivedStateFromProps(props) {\n      //$off\n      store.setState(props.value)\n      return {\n        currentValue: props.value,\n      }\n    }\n    render() {\n      return this.props.children\n    }\n  }\n}\n","//@flow\n\nimport * as React from 'react'\nimport type {Store} from 'effector'\nimport {createStoreConsumer} from './createStoreConsumer'\n\nexport function createContextComponent<Props, State, Context>(\n  store: Store<State>,\n  context: React.Context<Context>,\n  renderProp: (props: Props, state: State, context: Context) => React.Node,\n): React.ComponentType<Props> {\n  const Consumer = createStoreConsumer(store)\n  return class RenderComponent extends React.Component<Props> {\n    static contextType = context\n    renderProp = (state: State) => renderProp(this.props, state, this.context)\n    render() {\n      return <Consumer>{this.renderProp}</Consumer>\n    }\n  }\n}\n","//@flow\n\nimport * as React from 'react'\nimport type {Store} from 'effector'\nimport {createStoreConsumer} from './createStoreConsumer'\n\nexport function createComponent<Props, State>(\n  store: Store<State>,\n  renderProp: (props: Props, state: State) => React.Node,\n): React.ComponentType<Props> {\n  const Consumer = createStoreConsumer(store)\n  return class RenderComponent extends React.Component<Props> {\n    renderProp = (state: State) => renderProp(this.props, state)\n    render() {\n      return <Consumer>{this.renderProp}</Consumer>\n    }\n  }\n}\n","//@flow\n\nimport type {Store} from 'effector'\nimport {useState, useReducer, useEffect} from 'react'\n\nexport function useStore<State>(store: Store<State>): State {\n  const [state, setState] = useState(store.getState)\n  useEffect(() => store.watch(newState => setState(() => newState)), [store])\n  return state\n}\n\nexport function useStoreFast<State>(store: Store<State>): State {\n  const [state, dispatch] = useReducer(\n    (_, payload) => payload,\n    undefined,\n    store.getState,\n  )\n  useEffect(() => store.watch(dispatch), [store])\n  return state\n}\n","//@flow\n\nimport * as React from 'react'\n\nimport type {Store} from 'effector'\nimport {createReactState} from './createReactState'\n\nexport function connect<State: Object, Com: React.ComponentType<*>>(\n  Component: Com,\n): (\n  store: Store<State>,\n) => React.ComponentType<$Exact<$Diff<React.ElementConfig<Com>, State>>> {\n  return store => createReactState(store, Component)\n}\n"],"names":["createStoreConsumer","store","React","state","currentState","getState","_unsubscribe","_hasUnmounted","componentDidMount","subscribe","componentWillUnmount","unsubscribe","render","this","props","children","setState","prevState","displayName","shortName","createReactState","Component","Store","ConnectedComponent","React.createElement","name","createStore","createDomain","currentValue","value","defaultProps","context","renderProp","Consumer","contextType","useState","useEffect","watch","newState","createGate","defaultState","status","set","createApi","_","open","GateComponent","predicate","close","destructor","childName","gate","isOpen","isFeedback","current","isTerminated","unwatch","unwatch2","map","reset","setTerminated","undestruct","off","unstate"],"mappings":"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"}