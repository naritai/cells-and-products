(function(e,t){'object'==typeof exports&&'undefined'!=typeof module?t(exports,require('react'),require('effector')):'function'==typeof define&&define.amd?define(['exports','react','effector'],t):t((e=e||self).effectorReact={},e.React,e.effector)})(this,function(e,t,effector){function n(e){var n,r;return r=n=class extends t.Component{constructor(){super(...arguments),this.state={currentState:e.getState()},this._unsubscribe=null,this._hasUnmounted=0}componentDidMount(){this.subscribe()}componentWillUnmount(){this.unsubscribe(),this._hasUnmounted=1}render(){return this.props.children(this.state.currentState)}subscribe(){const t=e.subscribe(e=>{this._hasUnmounted||this.setState(t=>e===t.currentState?null:{currentState:e})});this._unsubscribe=t}unsubscribe(){'function'==typeof this._unsubscribe&&this._unsubscribe(),this._unsubscribe=null}},n.displayName=`${e.shortName}.Consumer`,r}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function s(e,s){const o=n(e),c=e=>t.createElement(o,null,n=>t.createElement(s,r({},e,n)));return c.displayName=`Connect(${s.displayName||s.name||'Unknown'})`,c}const o=effector.createDomain('Gate').store;e.createStoreConsumer=n,e.unstable_createStoreProvider=function(e){var n,r;return r=n=class extends t.Component{constructor(){super(...arguments),this.state={currentValue:null}}static getDerivedStateFromProps(t){return e.setState(t.value),{currentValue:t.value}}render(){return this.props.children}},n.displayName=`${e.shortName}.Provider`,n.defaultProps={children:null},r},e.createContextComponent=function(e,r,s){var o,c;const u=n(e);return c=o=class extends t.Component{constructor(){super(...arguments),this.renderProp=(e=>s(this.props,e,this.context))}render(){return t.createElement(u,null,this.renderProp)}},o.contextType=r,c},e.createComponent=function(e,r){const s=n(e);return class extends t.Component{constructor(){super(...arguments),this.renderProp=(e=>r(this.props,e))}render(){return t.createElement(s,null,this.renderProp)}}},e.useStore=function(e){const n=t.useState(e.getState),r=n[0],s=n[1];return t.useEffect(()=>e.watch(e=>s(()=>e)),[e]),r},e.connect=function(e){return t=>s(t,e)},e.createReactState=s,e.createGate=function e(n,r){void 0===n&&(n='gate'),void 0===r&&(r={});const s=o(0),c=o(r),u=effector.createApi(c,{set:(e,t)=>t}).set,a=effector.createApi(s,{open:()=>d.predicate()&&1,close:()=>0,destructor:()=>0}),i=a.open,p=a.close,l=a.destructor;class d extends t.PureComponent{static childGate(t){void 0===t&&(t='Subgate');const r=e(`${n}/${t}`);r.predicate=(()=>d.status.getState());let s=0,o=0;return r.open.watch(()=>{o||(s=1)}),r.close.watch(()=>{o||(s=0)}),d.status.watch(e=>{o=1,s&&e&&!r.status.getState()&&r.open(),o=0}),d.close.watch(()=>{o=1,r.close(),o=0}),d.destructor.watch(()=>r.destructor()),r}componentDidMount(){d.open()}componentWillUnmount(){d.close()}render(){return d.set(this.props),null}}d.predicate=(()=>1),d.displayName=`Gate:${n}`,d.isOpen=0,d.current=c.getState(),d.open=i,d.close=p,d.status=s,d.state=c,d.set=u,d.destructor=l,d.isTerminated=0;const f=s.watch(e=>d.isOpen=e),h=c.watch(e=>d.current=e);s.map(e=>{e||(d.current=r)}),c.reset(p);const m=l.watch(()=>{d.isTerminated=1}),b=l.watch(()=>{b(),f(),h(),m(),(()=>{d.status.off(d.open),d.status.off(d.close),d.status.off(d.destructor)})(),d.state.off(d.set)});return d},e.useGate=function(e,n){void 0===n&&(n={}),t.useEffect(()=>(e.open(),()=>e.close()),[e]),e.set(n)},Object.defineProperty(e,'__esModule',{value:1})});
//# sourceMappingURL=effector-react.umd.js.map
